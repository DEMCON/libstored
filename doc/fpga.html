<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VHDL &mdash; libstored 1.7.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=a77542ef"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Python" href="py.html" />
    <link rel="prev" title="Utilities" href="cpp_util.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            libstored
          </a>
              <div class="version">
                1.7.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Content</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">libstored</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">CHANGELOG</a></li>
<li class="toctree-l1"><a class="reference external" href="https://demcon.github.io/libstored/libstored.sozi.html">Presentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp.html">C++</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">VHDL</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#store-entity">Store entity</a></li>
<li class="toctree-l2"><a class="reference internal" href="#store-package">Store package</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common-package">Common package</a></li>
<li class="toctree-l2"><a class="reference internal" href="#protocol">Protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#asciiescapelayer">AsciiEscapeLayer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bufferlayer">BufferLayer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#terminallayer">TerminalLayer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#uartlayer">UARTLayer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#filelayer">FileLayer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#teelayer">TeeLayer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xsimlayer">XsimLayer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#utilities">Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#libstored-droptail">libstored_droptail</a></li>
<li class="toctree-l3"><a class="reference internal" href="#libstored-stream-buffer">libstored_stream_buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#libstored-fifo">libstored_fifo</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="py.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">libstored</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">VHDL</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/doc/fpga.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="vhdl">
<h1>VHDL<a class="headerlink" href="#vhdl" title="Link to this heading"></a></h1>
<p>The generated VHDL entity for a store contains the following:</p>
<ul class="simple">
<li><p>All variables of the store (functions are not supported).</p></li>
<li><p>Every variable is available at its own port (parallel interface).</p></li>
<li><p>Depending on how the access variable is set, a variable is read-only,
write-only, read-write, or not available.</p></li>
<li><p>An AXI4 LITE slave interface allows accessing all variables that are at most
4 bytes in size.</p></li>
<li><p>Synchronizer implementation is integrated.</p></li>
<li><p>Multiple stores can be chained to pass Synchronizer messages over the same
protocol stack.</p></li>
</ul>
<section id="store-entity">
<h2>Store entity<a class="headerlink" href="#store-entity" title="Link to this heading"></a></h2>
<dl class="object">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">Store_hdl</span></span></dt>
<dd><p>The generated stores have the following entity definition (for the
ExampleFpga store in this case):</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span><span class="w"> </span><span class="nc">ExampleFpga_hdl</span><span class="w"> </span><span class="k">is</span>
<span class="w">   </span><span class="k">generic</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">SYSTEM_CLK_FREQ</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">integer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">100</span><span class="n">e6</span><span class="p">;</span>
<span class="w">      </span><span class="n">SYNC_OUT_INTERVAL_s</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">real</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">;</span>
<span class="w">      </span><span class="n">ID</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">natural</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="n">AXI_SLAVE</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">true</span><span class="p">;</span>
<span class="w">      </span><span class="n">BUFFER_AFTER_N_VARS</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">positive</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">      </span><span class="n">VAR_ACCESS</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ExampleFpga_pkg</span><span class="p">.</span><span class="n">var_access_t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ExampleFpga_pkg</span><span class="p">.</span><span class="n">VAR_ACCESS_RW</span><span class="p">;</span>
<span class="w">      </span><span class="n">SIMULATION</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">false</span>
<span class="w">   </span><span class="p">);</span>
<span class="w">   </span><span class="k">port</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">clk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">rstn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">var_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">ExampleFpga_pkg</span><span class="p">.</span><span class="n">var_out_t</span><span class="p">;</span>
<span class="w">      </span><span class="n">var_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">ExampleFpga_pkg</span><span class="p">.</span><span class="n">var_in_t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ExampleFpga_pkg</span><span class="p">.</span><span class="n">var_in_default</span><span class="p">;</span>
<span class="w">      </span><span class="n">sync_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">msg_t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">msg_term</span><span class="p">;</span>
<span class="w">      </span><span class="n">sync_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">msg_t</span><span class="p">;</span>
<span class="w">      </span><span class="n">sync_id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">unsigned</span><span class="p">(</span><span class="mi">15</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">      </span><span class="n">sync_chained_id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">unsigned</span><span class="p">(</span><span class="mi">15</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="k">others</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="n">sync_chained_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">msg_t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">msg_term</span><span class="p">;</span>
<span class="w">      </span><span class="n">sync_chained_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">msg_t</span><span class="p">;</span>
<span class="w">      </span><span class="n">sync_out_trigger</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="n">sync_out_hold</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="n">sync_out_irq</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">sync_out_have_changes</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">sync_connected</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">sync_in_busy</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">s_axi_araddr</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w">  </span><span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">31</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="k">others</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="sc">&#39;-&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="n">s_axi_arready</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">s_axi_arvalid</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w">  </span><span class="kt">std_logic</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="n">s_axi_awaddr</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w">  </span><span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">31</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="k">others</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="sc">&#39;-&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="n">s_axi_awready</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">s_axi_awvalid</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w">  </span><span class="kt">std_logic</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="n">s_axi_bready</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w">  </span><span class="kt">std_logic</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="n">s_axi_bresp</span><span class="w">   </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">      </span><span class="n">s_axi_bvalid</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">s_axi_rdata</span><span class="w">   </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">31</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">      </span><span class="n">s_axi_rready</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w">  </span><span class="kt">std_logic</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="n">s_axi_rresp</span><span class="w">   </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">      </span><span class="n">s_axi_rvalid</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">s_axi_wdata</span><span class="w">   </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w">  </span><span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">31</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">(</span><span class="k">others</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="sc">&#39;-&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="n">s_axi_wready</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">s_axi_wvalid</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w">  </span><span class="kt">std_logic</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span>
<span class="w">   </span><span class="p">);</span>
<span class="k">end</span><span class="w"> </span><span class="nc">ExampleFpga_hdl</span><span class="p">;</span>
</pre></div>
</div>
<dl>
<dt>SYSTEM_CLK_FREQ<span class="classifier">integer := 100e6</span></dt><dd><p>Clock frequency of <code class="docutils literal notranslate"><span class="pre">clk</span></code>.</p>
</dd>
<dt>SYNC_OUT_INTERVAL_s<span class="classifier">real := 0.1</span></dt><dd><p>Interval to send out Synchronizer messages.</p>
</dd>
<dt>ID<span class="classifier">natural := 0</span></dt><dd><p>The ID used for Hello messages.  If 0, the value is automatically
determined.</p>
</dd>
<dt>AXI_SLAVE<span class="classifier">boolean := true</span></dt><dd><p>Enable the AXI slave interface when set to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
</dd>
<dt>BUFFER_AFTER_N_VARS<span class="classifier">positive := 4</span></dt><dd><p>Inject buffers after the given number of variables.  A lower number
increases the latency of handling sync messages, but reduces the
combinatorial path length.</p>
</dd>
<dt>VAR_ACCESS<span class="classifier">ExampleFpga_pkg.var_access_t := ExampleFpga_pkg.VAR_ACCESS_RW</span></dt><dd><p>Allowed access of the variables within the store.  The default, all
read-write, is the most generic, but has the highest resource usage.</p>
<p>To override only a few access settings, assign a function to <code class="docutils literal notranslate"><span class="pre">VAR_ACCESS</span></code>,
with an implementation like this:</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="n">var_access</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">ExampleFpga_pkg</span><span class="p">.</span><span class="n">var_access_t</span><span class="w"> </span><span class="k">is</span>
<span class="w">   </span><span class="k">variable</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ExampleFpga_pkg</span><span class="p">.</span><span class="n">var_access_t</span><span class="p">;</span>
<span class="k">begin</span>
<span class="w">   </span><span class="n">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ExampleFpga_pkg</span><span class="p">.</span><span class="n">VAR_ACCESS_RW</span><span class="p">;</span>
<span class="w">   </span><span class="n">v</span><span class="p">.</span><span class="err">\</span><span class="n">t_clk</span><span class="err">\</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ACCESS_WO</span><span class="p">;</span>
<span class="w">   </span><span class="n">v</span><span class="p">.</span><span class="err">\</span><span class="n">default_register_write_count</span><span class="err">\</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">ACCESS_WO</span><span class="p">;</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="k">function</span><span class="p">;</span>
</pre></div>
</div>
<p>See also <a class="reference internal" href="#var-access-t"><span class="std std-ref">var_access_t</span></a>.</p>
</dd>
<dt>SIMULATION<span class="classifier">boolean := false</span></dt><dd><p>When <code class="docutils literal notranslate"><span class="pre">true</span></code>, reduce the sync timing, such that the interval is
better suitable for (slow) simulation.</p>
</dd>
<dt>clk<span class="classifier">in std_logic;</span></dt><dd><p>System clock.</p>
</dd>
<dt>rstn<span class="classifier">in std_logic;</span></dt><dd><p>Low-active reset.</p>
</dd>
<dt>var_out<span class="classifier">out ExampleFpga_pkg.var_out_t</span></dt><dd><p>All variables within the store.
See <a class="reference internal" href="#var-out-t"><span class="std std-ref">var_out_t</span></a> for a description and timing.</p>
</dd>
<dt>var_in<span class="classifier">in ExampleFpga_pkg.var_in_t := ExampleFpga_pkg.var_in_default</span></dt><dd><p>Interface to write variables.
See <a class="reference internal" href="#var-in-t"><span class="std std-ref">var_in_t</span></a> for a description and timing.</p>
</dd>
<dt>sync_in<span class="classifier">in msg_t := msg_term</span></dt><dd><p>Synchronization input.  Connect <code class="docutils literal notranslate"><span class="pre">sync_in</span></code> and <code class="docutils literal notranslate"><span class="pre">sync_out</span></code> to the
protocol stack.  Set to <code class="docutils literal notranslate"><span class="pre">msg_term</span></code> to disable synchronization.</p>
</dd>
<dt>sync_out<span class="classifier">out msg_t</span></dt><dd><p>Synchronization output.  Connect <code class="docutils literal notranslate"><span class="pre">sync_in</span></code> and <code class="docutils literal notranslate"><span class="pre">sync_out</span></code> to the
protocol stack.</p>
</dd>
<dt>sync_id<span class="classifier">out unsigned(15 downto 0)</span></dt><dd><p>The used ID for the Hello message. This equals <code class="docutils literal notranslate"><span class="pre">ID</span></code> when <code class="docutils literal notranslate"><span class="pre">ID</span></code> is
non-zero.  Otherwise, a non-zero value is determined. The value should be
constant.</p>
</dd>
<dt>sync_chained_id<span class="classifier">in unsigned(15 downto 0) := (others =&gt; ‘0’)</span></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">sync_id</span></code> of the chained store. If <code class="docutils literal notranslate"><span class="pre">ID</span></code> is zero, a
non-conflicting value is chosen for this store’s <code class="docutils literal notranslate"><span class="pre">sync_id</span></code>.</p>
</dd>
<dt>sync_chained_in<span class="classifier">in msg_t := msg_term</span></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">sync_out</span></code> of a chained store.</p>
</dd>
<dt>sync_chained_out<span class="classifier">out msg_t</span></dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">sync_in</span></code> of a chained store.</p>
</dd>
<dt>sync_out_trigger<span class="classifier">in std_logic := ‘0’</span></dt><dd><p>Trigger an immediate sequence of Synchronizer messages when set to high
for one clock cycle. When kept high, multiple sync sequences can be sent
back to back.</p>
</dd>
<dt>sync_out_hold<span class="classifier">in std_logic := ‘0’</span></dt><dd><p>When high, prevent automatically sending out Synchronizer messages.</p>
</dd>
<dt>sync_out_irq<span class="classifier">out std_logic</span></dt><dd><p>Interrupt flag that indicates that there is at least one Synchronizer
message to be passed over <code class="docutils literal notranslate"><span class="pre">sync_out</span></code>.</p>
</dd>
<dt>sync_out_have_changes<span class="classifier">out std_logic</span></dt><dd><p>Flag that indicates that a variable has been changed in the store, and
Synchronization is required. Either flag <code class="docutils literal notranslate"><span class="pre">sync_out_trigger</span></code>, or wait
till <code class="docutils literal notranslate"><span class="pre">SYNC_OUT_INTERVAL_s</span></code> has passed and synchronization is started.</p>
</dd>
<dt>sync_connected<span class="classifier">out std_logic</span></dt><dd><p>Flag that indicates that we have a connection with a remote Synchronizer
instance.</p>
</dd>
<dt>sync_in_busy<span class="classifier">out std_logic</span></dt><dd><p>Flag that is high when Synchronizer messages are being processed.</p>
</dd>
<dt>s_axi_*</dt><dd><p>AXI4 LITE slave interface. This is a read-write interface for all store
variables that are at most 32-bit in size.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="store-package">
<h2>Store package<a class="headerlink" href="#store-package" title="Link to this heading"></a></h2>
<dl class="object">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">Store_pkg</span></span></dt>
<dd><p>The generated package includes all store-specific settings, like initialization
values, and types to make handling all store variables easier.
The following items are most interesting:</p>
<dl id="var-out-t">
<dt>type var_out_t</dt><dd><p>This is a record with all variables. This is the output of the store,
with current data, and a flag that indicates when data has changed.
The fields in the record are generated based on the names in the store.
Check the generated package file to see how these names are translated.
The record for a store with only one <code class="docutils literal notranslate"><span class="pre">uint32</span></code> variable could look like
this:</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">subtype</span><span class="w"> </span><span class="err">\</span><span class="n">some_variable__type</span><span class="err">\</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="kt">unsigned</span><span class="p">(</span><span class="mi">31</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="k">type</span><span class="w"> </span><span class="err">\</span><span class="n">blob__out_t</span><span class="err">\</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">record</span>
<span class="w">   </span><span class="n">value</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="err">\</span><span class="n">some_variable__type</span><span class="err">\</span><span class="p">;</span>
<span class="w">   </span><span class="n">updated</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="k">record</span><span class="p">;</span>

<span class="k">type</span><span class="w"> </span><span class="n">var_out_t</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">record</span>
<span class="w">   </span><span class="err">\</span><span class="n">some_variable</span><span class="err">\</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="err">\</span><span class="n">some_variable__out_t</span><span class="err">\</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="k">record</span><span class="p">;</span>
</pre></div>
</div>
<p>The output timing is exemplified below.</p>
<img alt="../_images/wavedrom-e8f762e0-cf4a-46f8-b61f-aeda584738a0.svg" src="../_images/wavedrom-e8f762e0-cf4a-46f8-b61f-aeda584738a0.svg" /><p>During reset, the initial value is set at the output, 1 in this example.
When the value is written, via <code class="docutils literal notranslate"><span class="pre">var_in</span></code>, the AXI interface, or via the
Synchronizer, <code class="docutils literal notranslate"><span class="pre">value</span></code> is updated and <code class="docutils literal notranslate"><span class="pre">updated</span></code> is flagged for one
clock cycle.  The flag is set at every write, not only when the data
changes. The example above shows such case when the value 2 is set again.</p>
<p>When multiple variables are updated in one Synchronizer message, all of
these variables flag the <code class="docutils literal notranslate"><span class="pre">updated</span></code> flag at the same time. The latency
between writing a variable and when it is on the <code class="docutils literal notranslate"><span class="pre">var_out</span></code> port is
unspecified.</p>
<p>The value is undefined when the access of a variable is <code class="docutils literal notranslate"><span class="pre">ACCESS_WO</span></code> or
<code class="docutils literal notranslate"><span class="pre">ACCESS_NA</span></code>.</p>
</dd>
</dl>
<dl id="var-in-t">
<dt>type var_in_t</dt><dd><p>This is a record with all variables. This is the input of the store,
which can be used to write to variables. Writes are only accepted if the
access of a variable is <code class="docutils literal notranslate"><span class="pre">ACCESS_RW</span></code> or <code class="docutils literal notranslate"><span class="pre">ACCESS_WO</span></code>.</p>
<p>Variables can be updated in three ways: via the <code class="docutils literal notranslate"><span class="pre">var_in</span></code> port, via the
AXI interface, and via the Synchronizer. If writes happen at the same
time, the priority is in the same order. So, writes via <code class="docutils literal notranslate"><span class="pre">var_in</span></code> always
override other writes at the same time.</p>
<p>The record for a store with only one <code class="docutils literal notranslate"><span class="pre">uint32</span></code> variable could look like
this:</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">subtype</span><span class="w"> </span><span class="err">\</span><span class="n">some_variable__type</span><span class="err">\</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="kt">unsigned</span><span class="p">(</span><span class="mi">31</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>

<span class="k">type</span><span class="w"> </span><span class="err">\</span><span class="n">some_variable__in_t</span><span class="err">\</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">record</span>
<span class="w">   </span><span class="n">value</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="err">\</span><span class="n">some_variable__type</span><span class="err">\</span><span class="p">;</span>
<span class="w">   </span><span class="n">we</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="k">record</span><span class="p">;</span>

<span class="k">type</span><span class="w"> </span><span class="n">var_in_t</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">record</span>
<span class="w">   </span><span class="err">\</span><span class="n">some_variable</span><span class="err">\</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="err">\</span><span class="n">some_variable__in_t</span><span class="err">\</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="k">record</span><span class="p">;</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">we</span></code> is high, the <code class="docutils literal notranslate"><span class="pre">value</span></code> is written to the store.</p>
<img alt="../_images/wavedrom-29d908ce-0c44-414f-8383-a4d718bd0d3d.svg" src="../_images/wavedrom-29d908ce-0c44-414f-8383-a4d718bd0d3d.svg" /><p>In this example, the variable is set to 1 in the second cycle.  Consider
the case that a microcontroller and the FPGA synchronize a store.  If a
variable should be read-only for the microcontroller, <code class="docutils literal notranslate"><span class="pre">we</span></code> can be tied
high by the FPGA, such that the FPGA updates the variable constantly.  In
this case, the FPGA effectively forces the value in the store as
<code class="docutils literal notranslate"><span class="pre">value</span></code>.  The Synchronizer will send a stream of updates to the
microcontroller of these values. The example above shows forcing the value
to 2, 3, and 4 in consecutive cycles.</p>
</dd>
</dl>
<dl id="var-access-t">
<dt>type var_access_t</dt><dd><p>This record contains all variables, with its access specifier.
For example:</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">type</span><span class="w"> </span><span class="n">var_access_t</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">record</span>
<span class="w">   </span><span class="err">\</span><span class="n">some_variable</span><span class="err">\</span><span class="o">:</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">access_t</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="k">record</span><span class="p">;</span>
</pre></div>
</div>
<p>See also :ref:<code class="docutils literal notranslate"><span class="pre">access_t</span> <span class="pre">&lt;access_t&gt;</span></code>.</p>
</dd>
<dt>constant VAR_ACCESS_RW<span class="classifier">var_access_t</span></dt><dd><p>Set all variables in the store to <code class="docutils literal notranslate"><span class="pre">ACCESS_RW</span></code>.</p>
</dd>
<dt>constant VAR_ACCESS_RO<span class="classifier">var_access_t</span></dt><dd><p>Set all variables in the store to <code class="docutils literal notranslate"><span class="pre">ACCESS_RO</span></code>.</p>
</dd>
<dt>constant VAR_ACCESS_WO<span class="classifier">var_access_t</span></dt><dd><p>Set all variables in the store to <code class="docutils literal notranslate"><span class="pre">ACCESS_WO</span></code>.</p>
</dd>
<dt>constant VAR_ACCESS_NA<span class="classifier">var_access_t</span></dt><dd><p>Set all variables in the store to <code class="docutils literal notranslate"><span class="pre">ACCESS_NA</span></code>.</p>
</dd>
<dt>function merge(constant a, b<span class="classifier">var_in_t) return var_in_t</span></dt><dd><p>Merge two <code class="docutils literal notranslate"><span class="pre">var_in</span></code> signals into a single value, such that two sources
of variables can be fed into the store.  If both <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> set
<code class="docutils literal notranslate"><span class="pre">we</span></code> for the same variable, <code class="docutils literal notranslate"><span class="pre">a</span></code> has priority and the value of <code class="docutils literal notranslate"><span class="pre">b</span></code>
is ignored (there is no backpressure in place).</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="common-package">
<h2>Common package<a class="headerlink" href="#common-package" title="Link to this heading"></a></h2>
<dl class="object">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">libstored_pkg</span></span></dt>
<dd><dl id="access-t">
<dt>type access_t</dt><dd><p>This specifies the access type of a variable:</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">type</span><span class="w"> </span><span class="n">access_t</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="p">(</span><span class="n">ACCESS_RW</span><span class="p">,</span><span class="w"> </span><span class="n">ACCESS_RO</span><span class="p">,</span><span class="w"> </span><span class="n">ACCESS_WO</span><span class="p">,</span><span class="w"> </span><span class="n">ACCESS_NA</span><span class="p">);</span>
</pre></div>
</div>
<dl class="simple">
<dt>ACCESS_RW</dt><dd><p>A variable can be read and written by the FPGA, and is synchronized in
both directions.</p>
</dd>
<dt>ACCESS_RO</dt><dd><p>A variable can be read by the FPGA. Writes are ignored.
Synchronization is accepted, but not generated.</p>
</dd>
<dt>ACCESS_WO</dt><dd><p>A variable can be read and written by the FPGA. However, Synchronizer
messages are generated, but not accepted.</p>
</dd>
<dt>ACCESS_NA</dt><dd><p>The variable cannot be accessed by the FPGA. Synchronizer messages are
ignored.</p>
</dd>
</dl>
</dd>
<dt>type msg_t</dt><dd><p>This record holds all signals relevant to passing messages between protocol layers.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">type</span><span class="w"> </span><span class="n">msg_t</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">record</span>
<span class="w">   </span><span class="n">data</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">   </span><span class="n">last</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">   </span><span class="n">valid</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">   </span><span class="n">accept</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="k">end</span><span class="w"> </span><span class="k">record</span><span class="p">;</span>
</pre></div>
</div>
</dd>
<dt>constant msg_term<span class="classifier">msg_t</span></dt><dd><p>A constant that can be used as <code class="docutils literal notranslate"><span class="pre">msg_t</span></code> sequence terminator.  All
messages that reach the terminator, are accepted and dropped.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="protocol">
<h2>Protocol<a class="headerlink" href="#protocol" title="Link to this heading"></a></h2>
<p>The protocol stack can be built by chaining these components using two <code class="docutils literal notranslate"><span class="pre">msg_t</span></code> signals.
All layers have a similar interface:</p>
<dl class="object">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">Generic</span> <span class="pre">layer</span></span></dt>
<dd><div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span><span class="w"> </span><span class="nc">SomeLayer</span><span class="w"> </span><span class="k">is</span>
<span class="w">   </span><span class="k">port</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">clk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">rstn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>

<span class="w">      </span><span class="n">encode_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>
<span class="w">      </span><span class="n">encode_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>

<span class="w">      </span><span class="n">decode_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>
<span class="w">      </span><span class="n">decode_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>

<span class="w">      </span><span class="n">idle</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span>
<span class="w">   </span><span class="p">);</span>
<span class="k">end</span><span class="w"> </span><span class="nc">SomeLayer</span><span class="p">;</span>
</pre></div>
</div>
<dl class="simple">
<dt>encode_in</dt><dd><p>This holds data to be encoded from the store towards the hardware
infrastructure.</p>
</dd>
<dt>encode_out</dt><dd><p>This is <code class="docutils literal notranslate"><span class="pre">encode_in</span></code> encoded by this layer, and to be encoded by a lower
layer in the stack.</p>
</dd>
<dt>decode_in</dt><dd><p>The data received from a lower layer in the stack.</p>
</dd>
<dt>decode_out</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">decode_in</span></code> data, process by this layer, to be passed to a higher
layer in the stack.</p>
</dd>
<dt>idle</dt><dd><p>A flag that indicates that this layer is currently doing nothing.</p>
</dd>
</dl>
<p>Passing messages follows this scheme, which is resembles the AXI4-Stream Protocol:</p>
<img alt="../_images/wavedrom-3ba58a2b-417f-4ef4-99b2-bd19192f6b1a.svg" src="../_images/wavedrom-3ba58a2b-417f-4ef4-99b2-bd19192f6b1a.svg" /><p><code class="docutils literal notranslate"><span class="pre">data</span></code> is accepted when <code class="docutils literal notranslate"><span class="pre">valid</span></code> and <code class="docutils literal notranslate"><span class="pre">accept</span></code> are high at the same
clock edge.  In the example above, this happens at edge 2, 3, 6, 9, and 10.
There is no order or dependency in <code class="docutils literal notranslate"><span class="pre">valid</span></code> and <code class="docutils literal notranslate"><span class="pre">accept</span></code>; both can be
high while other is not, indicating ‘there is data’, or ‘the data can be
accepted, if any’, respectively.</p>
<p>A message consists of a sequence of data bytes. <code class="docutils literal notranslate"><span class="pre">last</span></code> signals the end of
the current message. It depends on the protocol layer if and how this is
handled.</p>
<p><code class="docutils literal notranslate"><span class="pre">encode_in</span></code> and <code class="docutils literal notranslate"><span class="pre">decode_out</span></code> form the pair that connect to a higher
layer, <code class="docutils literal notranslate"><span class="pre">encode_out</span></code> and <code class="docutils literal notranslate"><span class="pre">decode_in</span></code> is a pair to a lower layer.  The
<code class="docutils literal notranslate"><span class="pre">accept</span></code> signal is in the reverse direction as the others.  To ease
integration, <code class="docutils literal notranslate"><span class="pre">accept</span></code> is in the counterpart of the pair; so
<code class="docutils literal notranslate"><span class="pre">decode_out.accept</span></code> belongs to <code class="docutils literal notranslate"><span class="pre">encode_in.valid</span></code>, and
<code class="docutils literal notranslate"><span class="pre">encode_in.accept</span></code> belongs to <code class="docutils literal notranslate"><span class="pre">decode_out.valid</span></code>. For <code class="docutils literal notranslate"><span class="pre">encode_out</span></code> and
<code class="docutils literal notranslate"><span class="pre">decode_in</span></code>, the same applies.</p>
</dd></dl>

<section id="asciiescapelayer">
<h3>AsciiEscapeLayer<a class="headerlink" href="#asciiescapelayer" title="Link to this heading"></a></h3>
<dl class="object">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">AsciiEscapeLayer</span></span></dt>
<dd><p>VHDL counterpart of <a class="reference internal" href="cpp_protocol.html#_CPPv4N6stored16AsciiEscapeLayerE" title="stored::AsciiEscapeLayer"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">stored::AsciiEscapeLayer</span></code></a>.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span><span class="w"> </span><span class="nc">AsciiEscapeLayer</span><span class="w"> </span><span class="k">is</span>
<span class="w">   </span><span class="k">generic</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">ESCAPE_ALL</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">false</span><span class="p">;</span>
<span class="w">      </span><span class="n">ENCODE_OUT_FIFO_DEPTH</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">natural</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="n">DECODE_OUT_FIFO_DEPTH</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">natural</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">   </span><span class="p">);</span>
<span class="w">   </span><span class="k">port</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">clk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">rstn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>

<span class="w">      </span><span class="n">encode_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>
<span class="w">      </span><span class="n">encode_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>

<span class="w">      </span><span class="n">decode_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>
<span class="w">      </span><span class="n">decode_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>

<span class="w">      </span><span class="n">idle</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span>
<span class="w">   </span><span class="p">);</span>
<span class="k">end</span><span class="w"> </span><span class="nc">AsciiEscapeLayer</span><span class="p">;</span>
</pre></div>
</div>
<dl class="simple">
<dt>ESCAPE_ALL<span class="classifier">boolean := false</span></dt><dd><p>When <code class="docutils literal notranslate"><span class="pre">true</span></code>, escape all ASCII control characters,
otherwise only the subset that conflict with other protocol layers.</p>
</dd>
<dt>ENCODE_OUT_FIFO_DEPTH<span class="classifier">natural := 0</span></dt><dd><p>The minimum FIFO size to be inserted before <code class="docutils literal notranslate"><span class="pre">encode_out</span></code>.
Set to 0 to allow pass-through.</p>
</dd>
<dt>DECODE_OUT_FIFO_DEPTH<span class="classifier">natural := 0</span></dt><dd><p>The minimum FIFO size to be inserted before <code class="docutils literal notranslate"><span class="pre">decode_out</span></code>.
Set to 0 to allow pass-through.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="bufferlayer">
<h3>BufferLayer<a class="headerlink" href="#bufferlayer" title="Link to this heading"></a></h3>
<dl class="object">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">BufferLayer</span></span></dt>
<dd><p>Buffer messages in a FIFO.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span><span class="w"> </span><span class="nc">BufferLayer</span><span class="w"> </span><span class="k">is</span>
<span class="w">   </span><span class="k">generic</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">ENCODE_DEPTH</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">natural</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">      </span><span class="n">DECODE_DEPTH</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">natural</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">   </span><span class="p">);</span>
<span class="w">   </span><span class="k">port</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">clk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">rstn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>

<span class="w">      </span><span class="n">encode_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_term</span><span class="p">;</span>
<span class="w">      </span><span class="n">encode_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>

<span class="w">      </span><span class="n">decode_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_term</span><span class="p">;</span>
<span class="w">      </span><span class="n">decode_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>

<span class="w">      </span><span class="n">idle</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span>
<span class="w">   </span><span class="p">);</span>
<span class="k">end</span><span class="w"> </span><span class="nc">BufferLayer</span><span class="p">;</span>
</pre></div>
</div>
<dl class="simple">
<dt>ENCODE_DEPTH<span class="classifier">natural := 1</span></dt><dd><p>The minimum FIFO size in the encode path.</p>
</dd>
<dt>DECODE_DEPTH<span class="classifier">natural := 1</span></dt><dd><p>The minimum FIFO size in the decode path.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="terminallayer">
<h3>TerminalLayer<a class="headerlink" href="#terminallayer" title="Link to this heading"></a></h3>
<dl class="object">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">TerminalLayer</span></span></dt>
<dd><p>VHDL counterpart of <a class="reference internal" href="cpp_protocol.html#_CPPv4N6stored13TerminalLayerE" title="stored::TerminalLayer"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">stored::TerminalLayer</span></code></a>.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span><span class="w"> </span><span class="nc">TerminalLayer</span><span class="w"> </span><span class="k">is</span>
<span class="w">   </span><span class="k">generic</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">ENCODE_OUT_FIFO_DEPTH</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">natural</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="n">DECODE_IN_FIFO_DEPTH</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">natural</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="n">DECODE_OUT_FIFO_DEPTH</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">natural</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">      </span><span class="n">TERMINAL_OUT_FIFO_DEPTH</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">natural</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">   </span><span class="p">);</span>
<span class="w">   </span><span class="k">port</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">clk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">rstn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>

<span class="w">      </span><span class="n">encode_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>
<span class="w">      </span><span class="n">encode_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>

<span class="w">      </span><span class="n">decode_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>
<span class="w">      </span><span class="n">decode_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>

<span class="w">      </span><span class="n">terminal_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_term</span><span class="p">;</span>
<span class="w">      </span><span class="n">terminal_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>

<span class="w">      </span><span class="n">idle</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span>
<span class="w">   </span><span class="p">);</span>
<span class="k">end</span><span class="w"> </span><span class="nc">TerminalLayer</span><span class="p">;</span>
</pre></div>
</div>
<dl class="simple">
<dt>ENCODE_OUT_FIFO_DEPTH<span class="classifier">natural := 0</span></dt><dd><p>The minimum FIFO size to be inserted before <code class="docutils literal notranslate"><span class="pre">encode_out</span></code>.
Set to 0 to allow pass-through.</p>
</dd>
<dt>DECODE_IN_FIFO_DEPTH<span class="classifier">natural := 0</span></dt><dd><p>The minimum FIFO size to be inserted after <code class="docutils literal notranslate"><span class="pre">decode_in</span></code>.
Set to 0 to allow pass-through.</p>
</dd>
<dt>DECODE_OUT_FIFO_DEPTH<span class="classifier">natural := 1</span></dt><dd><p>The minimum FIFO size to be inserted before <code class="docutils literal notranslate"><span class="pre">decode_out</span></code>.
Set to 0 to allow pass-through.</p>
</dd>
<dt>TERMINAL_OUT_FIFO_DEPTH<span class="classifier">natural := 1</span></dt><dd><p>The minimum FIFO size to be inserted before <code class="docutils literal notranslate"><span class="pre">terminal_out</span></code>.
Set to 0 to allow pass-through.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="uartlayer">
<h3>UARTLayer<a class="headerlink" href="#uartlayer" title="Link to this heading"></a></h3>
<dl class="object">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">UARTLayer</span></span></dt>
<dd><p>UART end of the protocol stack, with optional RTS/CTS hardware flow control.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span><span class="w"> </span><span class="nc">UARTLayer</span><span class="w"> </span><span class="k">is</span>
<span class="w">   </span><span class="k">generic</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">SYSTEM_CLK_FREQ</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">integer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">100</span><span class="n">e6</span><span class="p">;</span>
<span class="w">      </span><span class="n">BAUD</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">integer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">115200</span><span class="p">;</span>
<span class="w">      </span><span class="n">DECODE_OUT_FIFO_DEPTH</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">natural</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">   </span><span class="p">);</span>
<span class="w">   </span><span class="k">port</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">clk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">rstn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>

<span class="w">      </span><span class="n">encode_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>
<span class="w">      </span><span class="n">decode_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>

<span class="w">      </span><span class="n">rx</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">tx</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">cts</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="n">rts</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>

<span class="w">      </span><span class="n">idle</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span>
<span class="w">   </span><span class="p">);</span>
<span class="k">end</span><span class="w"> </span><span class="nc">UARTLayer</span><span class="p">;</span>
</pre></div>
</div>
<dl class="simple">
<dt>SYSTEM_CLK_FREQ<span class="classifier">integer := 100e6</span></dt><dd><p>Frequency of <code class="docutils literal notranslate"><span class="pre">clk</span></code>.</p>
</dd>
<dt>BAUD<span class="classifier">integer := 115200</span></dt><dd><p>Baud rate to be used for <code class="docutils literal notranslate"><span class="pre">rx</span></code> and <code class="docutils literal notranslate"><span class="pre">tx</span></code>.</p>
</dd>
<dt>DECODE_OUT_FIFO_DEPTH<span class="classifier">natural := 0</span></dt><dd><p>The minimum FIFO size to be inserted before <code class="docutils literal notranslate"><span class="pre">decode_out</span></code>.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="filelayer">
<h3>FileLayer<a class="headerlink" href="#filelayer" title="Link to this heading"></a></h3>
<dl class="object">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">FileLayer</span></span></dt>
<dd><p>File backend of the protocol stack.
Only available for simulation.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span><span class="w"> </span><span class="nc">FileLayer</span><span class="w"> </span><span class="k">is</span>
<span class="w">   </span><span class="k">generic</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">SLEEP_s</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">real</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="n">e</span><span class="o">-</span><span class="mi">6</span><span class="p">;</span>
<span class="w">      </span><span class="n">FILENAME_IN</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;stack_in.txt&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="n">FILENAME_OUT</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;stack_out.txt&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="n">VERBOSE</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">false</span>
<span class="w">   </span><span class="p">);</span>
<span class="w">   </span><span class="k">port</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">clk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">rstn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>

<span class="w">      </span><span class="n">encode_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>
<span class="w">      </span><span class="n">decode_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>

<span class="w">      </span><span class="n">idle</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span>
<span class="w">   </span><span class="p">);</span>
<span class="k">end</span><span class="w"> </span><span class="nc">FileLayer</span><span class="p">;</span>
</pre></div>
</div>
<dl class="simple">
<dt>SLEEP_s<span class="classifier">real := 100.0e-6</span></dt><dd><p>Do a <code class="docutils literal notranslate"><span class="pre">wait</span> <span class="pre">for</span> <span class="pre">SLEEP_s</span> <span class="pre">*</span> <span class="pre">1</span> <span class="pre">sec</span></code> when a <code class="docutils literal notranslate"><span class="pre">nul</span></code> byte is received.
This way, the simulation does not block all the time on input data.
Some throttling can be implemented this way.</p>
</dd>
<dt>FILENAME_IN<span class="classifier">string := “stack_in.txt”</span></dt><dd><p>File to read from. This can also be a named pipe.</p>
</dd>
<dt>FILENAME_OUT<span class="classifier">string := “stack_out.txt”</span></dt><dd><p>File to write to. This can also be a named pipe.</p>
</dd>
<dt>VERBOSE<span class="classifier">boolean := false</span></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">true</span></code>, report every read/write to the log.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="teelayer">
<h3>TeeLayer<a class="headerlink" href="#teelayer" title="Link to this heading"></a></h3>
<dl class="object">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">TeeLayer</span></span></dt>
<dd><p>Write all encoded and/or decoded data to a file, like the UNIX tool <code class="docutils literal notranslate"><span class="pre">tee</span></code>.
Only available for simulation.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span><span class="w"> </span><span class="nc">TeeLayer</span><span class="w"> </span><span class="k">is</span>
<span class="w">   </span><span class="k">generic</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">FILENAME_ENCODE</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="n">FILENAME_DECODE</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">   </span><span class="p">);</span>
<span class="w">   </span><span class="k">port</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">clk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">rstn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>

<span class="w">      </span><span class="n">encode_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>
<span class="w">      </span><span class="n">encode_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>

<span class="w">      </span><span class="n">decode_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>
<span class="w">      </span><span class="n">decode_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>

<span class="w">      </span><span class="n">idle</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span>
<span class="w">   </span><span class="p">);</span>
<span class="k">end</span><span class="w"> </span><span class="nc">TeeLayer</span><span class="p">;</span>
</pre></div>
</div>
<dl class="simple">
<dt>FILENAME_ENCODE<span class="classifier">string := “”</span></dt><dd><p>File name to write encoded data to.
Only used when not empty.</p>
</dd>
<dt>FILENAME_DECODE<span class="classifier">string := “”</span></dt><dd><p>File name to write decoded data to.
Only used when not empty.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="xsimlayer">
<h3>XsimLayer<a class="headerlink" href="#xsimlayer" title="Link to this heading"></a></h3>
<dl class="object">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">XsimLayer</span></span></dt>
<dd><p>VHDL counterpart of <a class="reference internal" href="cpp_protocol.html#_CPPv4N6stored9XsimLayerE" title="stored::XsimLayer"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">stored::XsimLayer</span></code></a>.
Only available in simulation.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span><span class="w"> </span><span class="nc">XsimLayer</span><span class="w"> </span><span class="k">is</span>
<span class="w">   </span><span class="k">generic</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">PIPE_PREFIX</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">      </span><span class="n">VERBOSE</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">false</span>
<span class="w">   </span><span class="p">);</span>
<span class="w">   </span><span class="k">port</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">clk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">rstn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>

<span class="w">      </span><span class="n">encode_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>
<span class="w">      </span><span class="n">decode_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">libstored_pkg</span><span class="p">.</span><span class="n">msg_t</span><span class="p">;</span>

<span class="w">      </span><span class="n">idle</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span>
<span class="w">   </span><span class="p">);</span>
<span class="k">end</span><span class="w"> </span><span class="nc">XsimLayer</span><span class="p">;</span>
</pre></div>
</div>
<dl class="simple">
<dt>PIPE_PREFIX<span class="classifier">string</span></dt><dd><p>Prefix used for the three named pipes.</p>
</dd>
<dt>VERBOSE<span class="classifier">boolean := false</span></dt><dd><p>When <code class="docutils literal notranslate"><span class="pre">true</span></code>, show detailed information about all exchanged bytes.</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="utilities">
<h2>Utilities<a class="headerlink" href="#utilities" title="Link to this heading"></a></h2>
<section id="libstored-droptail">
<h3>libstored_droptail<a class="headerlink" href="#libstored-droptail" title="Link to this heading"></a></h3>
<dl class="object">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">libstored_droptail</span></span></dt>
<dd><p>Drop the tail with a fixed length from a message.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span><span class="w"> </span><span class="nc">libstored_droptail</span><span class="w"> </span><span class="k">is</span>
<span class="w">   </span><span class="k">generic</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">FIFO_DEPTH</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">natural</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="n">TAIL_LENGTH</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">positive</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">   </span><span class="p">);</span>
<span class="w">   </span><span class="k">port</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">clk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">rstn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>

<span class="w">      </span><span class="n">data_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">      </span><span class="n">valid_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">last_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">accept_in</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">drop</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="sc">&#39;1&#39;</span><span class="p">;</span>

<span class="w">      </span><span class="n">data_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic_vector</span><span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">      </span><span class="n">valid_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">last_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">accept_out</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span>
<span class="w">   </span><span class="p">);</span>
<span class="k">end</span><span class="w"> </span><span class="nc">libstored_droptail</span><span class="p">;</span>
</pre></div>
</div>
<p>Example that drops a tail of length 1:</p>
<img alt="../_images/wavedrom-410bdad7-fa4e-49cd-8458-e42e85d35caa.svg" src="../_images/wavedrom-410bdad7-fa4e-49cd-8458-e42e85d35caa.svg" /><p>Note that the precise latency from <code class="docutils literal notranslate"><span class="pre">data_in</span></code> to <code class="docutils literal notranslate"><span class="pre">data_out</span></code> is
unspecified.</p>
<dl class="simple">
<dt>FIFO_DEPTH<span class="classifier">natural := 0</span></dt><dd><p>Minimum FIFO depth. Set to 0 to allow pass-through.</p>
</dd>
<dt>TAIL_LENGTH<span class="classifier">positive := 1</span></dt><dd><p>The tail to be dropped.</p>
</dd>
<dt>drop<span class="classifier">in std_logic</span></dt><dd><p>This signal is sampled when <code class="docutils literal notranslate"><span class="pre">last_in</span></code> is high.
When <code class="docutils literal notranslate"><span class="pre">drop</span></code> is high, the tail of the message is dropped.
So, <code class="docutils literal notranslate"><span class="pre">last_out</span></code> is moved a bit back in the stream in that case.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="libstored-stream-buffer">
<h3>libstored_stream_buffer<a class="headerlink" href="#libstored-stream-buffer" title="Link to this heading"></a></h3>
<dl class="object">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">libstored_stream_buffer</span></span></dt>
<dd><p>Break long combinatorial path by inserting flipflops.
This is effectively a FIFO of size 1.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span><span class="w"> </span><span class="nc">libstored_stream_buffer</span><span class="w"> </span><span class="k">is</span>
<span class="w">   </span><span class="k">generic</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">WIDTH</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">positive</span>
<span class="w">   </span><span class="p">);</span>
<span class="w">   </span><span class="k">port</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">clk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">rstn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>

<span class="w">      </span><span class="n">i</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic_vector</span><span class="p">(</span><span class="n">WIDTH</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">      </span><span class="n">i_valid</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">i_accept</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>

<span class="w">      </span><span class="n">o</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic_vector</span><span class="p">(</span><span class="n">WIDTH</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">      </span><span class="n">o_valid</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">o_accept</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span>
<span class="w">   </span><span class="p">);</span>
<span class="k">end</span><span class="w"> </span><span class="nc">libstored_stream_buffer</span><span class="p">;</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="libstored-fifo">
<h3>libstored_fifo<a class="headerlink" href="#libstored-fifo" title="Link to this heading"></a></h3>
<dl class="object">
<dt class="sig sig-object">
<span class="sig-name descname"><span class="pre">libstored_fifo</span></span></dt>
<dd><p>FIFO with optional conditional push, and lookahead before actual pop.</p>
<div class="highlight-vhdl notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span><span class="w"> </span><span class="nc">libstored_fifo</span><span class="w"> </span><span class="k">is</span>
<span class="w">   </span><span class="k">generic</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">WIDTH</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">positive</span><span class="p">;</span>
<span class="w">      </span><span class="n">DEPTH</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">natural</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">      </span><span class="n">ALMOST_FULL_REMAINING</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">natural</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="n">ALMOST_EMPTY_REMAINING</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">natural</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">   </span><span class="p">);</span>
<span class="w">   </span><span class="k">port</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">clk</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">rstn</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>

<span class="w">      </span><span class="n">i</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic_vector</span><span class="p">(</span><span class="n">WIDTH</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">      </span><span class="n">i_valid</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">i_accept</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">i_commit</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="sc">&#39;1&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="n">i_rollback</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>

<span class="w">      </span><span class="n">o</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic_vector</span><span class="p">(</span><span class="n">WIDTH</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">downto</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">      </span><span class="n">o_valid</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">o_accept</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">o_commit</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="sc">&#39;1&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="n">o_rollback</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">std_logic</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">;</span>

<span class="w">      </span><span class="n">full</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">empty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">almost_full</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span><span class="p">;</span>
<span class="w">      </span><span class="n">almost_empty</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">std_logic</span>
<span class="w">   </span><span class="p">);</span>
<span class="k">end</span><span class="w"> </span><span class="nc">libstored_fifo</span><span class="p">;</span>
</pre></div>
</div>
<p>Example to drop and commit pushed data:</p>
<img alt="../_images/wavedrom-6bdf1183-6e9e-4b8c-be56-5bb05508491b.svg" src="../_images/wavedrom-6bdf1183-6e9e-4b8c-be56-5bb05508491b.svg" /><p>Example to drop and commit popped data having a FIFO size of 4:</p>
<img alt="../_images/wavedrom-d7c74d97-d237-4a6a-9ef1-01ba4345b930.svg" src="../_images/wavedrom-d7c74d97-d237-4a6a-9ef1-01ba4345b930.svg" /><dl class="simple">
<dt>WIDTH<span class="classifier">positive</span></dt><dd><p>Data width.</p>
</dd>
<dt>DEPTH<span class="classifier">natural := 1</span></dt><dd><p>Minimum FIFO depth.</p>
</dd>
<dt>ALMOST_FULL_REMAINING<span class="classifier">natural := 0</span></dt><dd><p>Set <code class="docutils literal notranslate"><span class="pre">almost_full</span></code> high when at most this number of elements can be
pushed in the FIFO without blocking.</p>
</dd>
<dt>ALMOST_EMPTY_REMAINING<span class="classifier">natural := 0</span></dt><dd><p>Set <code class="docutils literal notranslate"><span class="pre">almost_empty</span></code> high when at most this number of elements can be
popped from the FIFO without blocking.</p>
</dd>
<dt>i_commit<span class="classifier">in std_logic := ‘1’</span></dt><dd><p>When high, make the already pushed data aviable for the consumer side.
Data that is pushed in the same clock cycle is also committed.</p>
</dd>
<dt>i_rollback<span class="classifier">in std_logic := ‘0’</span></dt><dd><p>Drop all previously uncommitted data.  Data that is pushed in the same
clock cycle is also dropped.  If <code class="docutils literal notranslate"><span class="pre">i_commit</span></code> is high in the same cycle,
it is ignored, and the data is dropped.</p>
</dd>
<dt>o_commit<span class="classifier">in std_logic := ‘1’</span></dt><dd><p>Remove previously popped data from the FIFO, such that space is made for
the producer side to push more.</p>
</dd>
<dt>o_rollback<span class="classifier">in std_logic := ‘0’</span></dt><dd><p>Revert previously uncommited popped data, such that this data can be read
again.</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cpp_util.html" class="btn btn-neutral float-left" title="Utilities" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="py.html" class="btn btn-neutral float-right" title="Python" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2023, Jochem Rutgers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>