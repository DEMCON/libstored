<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libstored: debugger</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libstored
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__libstored__debugger.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle">
<div class="title">debugger<div class="ingroups"><a class="el" href="group__libstored.html">libstored</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Embedded Debugger message handling.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classstored_1_1_debugger.html">stored::Debugger</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The application-layer implementation of the Embedded Debugger protocol.  <a href="classstored_1_1_debugger.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classstored_1_1_debug_store_base.html">stored::DebugStoreBase</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wrapper for a store, that hides the store's template parameters.  <a href="classstored_1_1_debug_store_base.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classstored_1_1_debug_variant.html">stored::DebugVariant</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A wrapper for any type of object in a store.  <a href="classstored_1_1_debug_variant.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Embedded Debugger message handling. </p>
<p>The default set of commands that is processed by <a class="el" href="classstored_1_1_debugger.html" title="The application-layer implementation of the Embedded Debugger protocol. ">stored::Debugger</a> is listed below. A subclass of Debugger may extend the set of capabilities, for application-specific purposes.</p>
<p>The protocol is a request-response mechanism; for every request, there must be a response. Requests are processed in order. This is the OSI application layer of the protocol stack. For other layers, see <a class="el" href="group__libstored__protocol.html">protocol</a>.</p>
<p>Requests always start with an ASCII character, which is the command. The response can be actual data, or with ack <code>!</code> or nack <code>?</code>. All requests and responses are usually plain ASCII (or UTF-8 for strings), to simplify processing it over a terminal or by humans. However, it does not have to be the case.</p>
<h3>Capabilities</h3>
<p>Request: <code>?</code> </p><pre class="fragment">?
</pre><p>Response: a list of command characters. </p><pre class="fragment">?rwe
</pre><p>This command is mandatory for every debugging target.</p>
<h3>Echo</h3>
<p>Request: <code>e</code> &lt;any data&gt; </p><pre class="fragment">eHello World
</pre><p>Response: &lt;the same data&gt; </p><pre class="fragment">Hello World
</pre><h3>Read</h3>
<p>Request: <code>r</code> &lt;name of object&gt;</p>
<p>(Every scope within) the name of the object may be abbreviated, as long as it is unambiguous. In case there is a alias created for the object (see Alias below), the alias character can be used instead of the name. </p><pre class="fragment">r/bla/asdf
</pre><p>Response: <code>?</code> | &lt;ASCII hex value of object&gt;</p>
<p>For values with fixed length (int, float), the byte order is big/network endian. For ints, the initial zeros can be omitted. For other data, all bytes are encoded. </p><pre class="fragment">123abc
</pre><h3>Write</h3>
<p>Request: <code>w</code> &lt;value in ASCII hex&gt; &lt;name of object&gt;</p>
<p>See Read for details about the hex value and object name. </p><pre class="fragment">w10/b/a
</pre><p>Response: <code>!</code> | <code>?</code> </p><pre class="fragment">!
</pre><h3>List</h3>
<p>Requests a full list of all objects of all registered stores to the current Embedded Debugger.</p>
<p>Request: <code>l</code> </p><pre class="fragment">l
</pre><p>Response: ( &lt;type byte in hex&gt; &lt;length in hex&gt; &lt;name of object&gt; <code>\n</code> ) * | <code>?</code> </p><pre class="fragment">3b4/b/i8
201/b/b
</pre><p>See <a class="el" href="structstored_1_1_type.html" title="Type traits of objects in a store. ">stored::Type</a> for the type byte. The type byte is always two hex characters. The number of characters of the length of the object depends on the value; leading zeros may be removed.</p>
<h3>Alias</h3>
<p>Assigns a character to a object path. An alias can be everywhere where an object path is expected. Creating aliases skips parsing the object path repeatedly, so makes debugging more efficient. If no object is specified, the alias is removed. The number of aliases may be limited. If the limit is hit, the response will be <code>?</code>. The alias name can be any char in the range 0x20 (<code>␣</code>) - 0x7e (<code>~</code>), except for 0x2f (<code>/</code>).</p>
<p>Request: <code>a</code> &lt;char&gt; ( &lt;name of object&gt; ) ? </p><pre class="fragment">a0/bla/a
</pre><p>Response: <code>!</code> | <code>?</code> </p><pre class="fragment">!
</pre><h3>Macro</h3>
<p>Saves a sequence of commands and assigns a name to it. The macro name can be any char in the range 0x20 (<code>␣</code>) - 0x7e (<code>~</code>). In case of a name clash with an existing non-macro command, the command is executed; the macro cannot hide or replace the command.</p>
<p>The separator can be any char, as long as it is not used within a command of the macro definition. Using <code>\r</code>, <code>\n</code>, or <code>\t</code> is usually safe, as it cannot occur inside a name.</p>
<p>Without the definition after the macro name, the macro is removed. The system may be limited in total definition length. The macro string is reinterpreted every time it is invoked.</p>
<p>The responses of the commands are merged into one response frame, without separators. The Echo command can be used to inject separators in the output.</p>
<p>Request: <code>m</code> &lt;char&gt; ( &lt;separator&gt; &lt;command&gt; ) * </p><pre class="fragment">mZ r/bla/a e; r/bla/z
</pre><p>Response: <code>!</code> | <code>?</code> </p><pre class="fragment">!
</pre><p>If the <code>Z</code> command is now executed, the result could be something like: </p><pre class="fragment">123;456
</pre><h3>Identification</h3>
<p>Returns a fixed string that identifies the application.</p>
<p>Request: <code>i</code> </p><pre class="fragment">i
</pre><p>Response: <code>?</code> | &lt;UTF-8 encoded application name&gt; </p><pre class="fragment">libstored
</pre><h3>Version</h3>
<p>Returns a list of versions.</p>
<p>Request: <code>v</code> </p><pre class="fragment">v
</pre><p>Response: <code>?</code> | &lt;protocol version&gt; ( <code>␣</code> &lt;application-specific version&gt; ) * </p><pre class="fragment">2 r243+trunk beta
</pre><h3>Read memory</h3>
<p>Read a memory via a pointer instead of the store. Returns the number of requested bytes. If no length is specified, a word is returned.</p>
<p>Request: <code>R</code> &lt;pointer in hex&gt; ( <code>␣</code> &lt;length&gt; ) ? </p><pre class="fragment">R1ffefff7cc 4
</pre><p>Response: <code>?</code> | &lt;bytes in hex&gt; </p><pre class="fragment">efbe0000
</pre><p>Bytes are just concatenated as they occur in memory, having the byte at the lowest address first.</p>
<h3>Write memory</h3>
<p>Write a memory via a pointer instead of the store.</p>
<p>Request: <code>W</code> &lt;pointer in hex&gt; <code>␣</code> &lt;bytes in hex&gt; </p><pre class="fragment">W1ffefff7cc 0123
</pre><p>Response: <code>?</code> | <code>!</code> </p><pre class="fragment">!
</pre><h3>Streams</h3>
<p>Read all available data from a stream. Streams are application-defined sequences of bytes, like stdout and stderr. They may contain binary data. There are an arbitrary number of streams, with an arbitrary single-char name, except for <code>?</code>, as it makes the response ambiguous.</p>
<p>To list all streams with data:</p>
<p>Request: <code>s</code></p>
<p>To request all data from a stream, where the optional suffix is appended to the response:</p>
<p>Request: <code>s</code> &lt;char&gt; &lt;suffix&gt; ? </p><pre class="fragment">sA/
</pre><p>Response: <code>?</code> | &lt;data&gt; &lt;suffix&gt; </p><pre class="fragment">Hello World!!1/
</pre><p>Once data has been read from the stream, it is removed. The next call will return new data. If a stream was never used, <code>?</code> is returned. If it was used, but it is empty now, the stream char does not show up in the <code>s</code> call, but does respond with the suffix. If no suffix was provided, and there is no data, the response is empty.</p>
<p>The number of streams and the maximum buffer size of a stream may be limited.</p>
<h3>Tracing</h3>
<p>Executes a macro every time the application invokes <a class="el" href="classstored_1_1_debugger.html#a65e235d57bae057514396431c97db437" title="Executes the trace macro and appends the output to the trace buffer. ">stored::Debugger::trace()</a>. A stream is filled with the macro output.</p>
<p>Request: <code>t</code> ( &lt;macro&gt; &lt;stream&gt; ( &lt;decimate in hex&gt; ) ? ) ? </p><pre class="fragment">tms64
</pre><p>This executes macro output of <code>m</code> to the stream <code>s</code>, but only one in every 100 calls to trace(). If the output does not fit in the stream buffer, it is silently dropped.</p>
<p><code>t</code> without arguments disables tracing. If the decimate argument is omitted, 1 is assumed (no decimate). Only one tracing configuration is supported; another <code>t</code> command with arguments overwrites the previous configuration.</p>
<p>Response: <code>?</code> | <code>!</code> </p><pre class="fragment">!
</pre><p>The buffer collects samples over time, which is read out by the client possibly at irregular intervals. Therefore, you probably want to know the time stamp of the sample. For this, include reading the time in the macro definition. By convention, the time is a top-level variable <code>t</code> with the unit between braces. It is implementation-defined what the offset is of <code>t</code>, which can be since the epoch or since the last boot, for example. For example, your store can have one of the following time variables: </p><pre class="fragment">// Nice resolution, wraps around after 500 millennia.
(uint64) t (us)
// Typical ARM systick counter, wraps around after 49 days.
(uint32) t (ms)
// Pythonic time. Watch out with significant bits.
(double) t (s)
</pre><p>The time is usually a function type, as it is read-only and reading it should invoke some time-keeping functions.</p>
<p>Macro executions are just concatenated in the stream buffer. Make sure to use the Echo command to inject proper separators to allow parsing the stream content afterwards.</p>
<p>For example, the following requests are typical to setup tracing: </p><pre class="fragment"># Define aliases to speed up macro processing.
at/t (us)
a1/some variable
a2/some other variable
# Save the initial start time offset to relate it to our wall clock.
rt
# Define a macro for tracing
mM rt e, r1 e, r2 e;
# Setup tracing
tMT
# Repeatedly read trace buffer
sT
sT
sT
...
</pre><p>Now, the returned stream buffer contains triplets of time, /some variable, /some other variable, like this: </p><pre class="fragment">101,1,2;102,1,2;103,1,2;
</pre><p>Depending on the buffer size, reading the buffer may be orders of magnitude slower than the actual tracing speed. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
