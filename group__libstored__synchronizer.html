<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libstored: synchronizer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libstored
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__libstored__synchronizer.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle">
<div class="title">synchronizer<div class="ingroups"><a class="el" href="group__libstored.html">libstored</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Distributed store synchronizer.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classstored_1_1_store_journal.html">stored::StoreJournal</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A record of all changes within a store.  <a href="classstored_1_1_store_journal.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classstored_1_1_sync_connection.html">stored::SyncConnection</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A one-to-one connection to synchronize one or more stores.  <a href="classstored_1_1_sync_connection.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classstored_1_1_synchronizable.html">stored::Synchronizable&lt; Base &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">An extension of a store to be used by the <a class="el" href="classstored_1_1_synchronizer.html" title="The service that manages synchronization of stores over SyncConnections. ">stored::Synchronizer</a>.  <a href="classstored_1_1_synchronizable.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classstored_1_1_synchronizer.html">stored::Synchronizer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The service that manages synchronization of stores over SyncConnections.  <a href="classstored_1_1_synchronizer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Distributed store synchronizer. </p>
<p>In a distributed system, every process has its own instance of a store. Synchronization between these instances is implemented by the <a class="el" href="classstored_1_1_synchronizer.html" title="The service that manages synchronization of stores over SyncConnections. ">stored::Synchronizer</a>. The Synchronizer can be seen as a service, usually one per process, which knows all stores in that process and all communication channels to other processes. At regular intervals, it sends updates of locally modified data to the other Synchronizers.</p>
<p>The topology can be configured at will. In principle, a process can have any number of stores, any number of synchronizers (which all handle any subset of the stores), any number of connections to any other process in the system.</p>
<p>There are a few rules to keep in mind:</p>
<ul>
<li>Only <a class="el" href="classstored_1_1_synchronizable.html" title="An extension of a store to be used by the stored::Synchronizer. ">stored::Synchronizable</a> stores can be handled by the Synchronizer. This has to be used correctly when the store is instantiated.</li>
<li>To synchronize a store, one must define which store is the one that provides the initial value. Upon connection between Synchronizers, the store's content is synchronized at once from one party to the other. Afterwards, updates are sent in both directions.</li>
<li>Writes to different objects in the same store by the same process are observed by every other process in the same order. All other write orders are undefined (like writes to objects of different stores by the same process, or writes to the same store by different processes), and can be observed to happen in a different order by different processes at the same time.</li>
<li>Writes to one object should only be done by one process. So, every process owns a subset of a store. If multiple processes write to the same object, behavior is undefined. That would be a race-condition anyway.</li>
<li>The communication is done in the store's endianness. If a distributed system have processors with different endianness, they should be configured to all-little or all-big endian. Accessing the store by the processor that has a store in a non-native endianness, might be a bit more expensive, but synchronization is cheaper.</li>
<li>Stores are identified by their (SHA-1) hash. This hash is computed over the full source code of the store (the .st file). So, only stores with the exact same definition, and therefore layout, can be synchronized.</li>
</ul>
<p>The protocol for synchronization consists of four messages. These are sent when appropriate, not in a request-response paradigm. There is no acknowledge. Invalid messages are just ignored.</p>
<h3>Hello</h3>
<p>"I would like to have the full state and future changes of the given store (by hash). All updates, send to me using this reference."</p>
<p><code>h</code> &lt;hash&gt; &lt;id&gt;</p>
<p>The hash is returned by the <code>hash()</code> function of the store, including the null-terminator. The id is arbitrary chosen by the Synchronizer, and is 16-bit in the store's endianness.</p>
<h3>Welcome (as a response to a Hello)</h3>
<p>"You are welcome. Here is the full buffer state, upon your request, of the store with given reference. Any updates to the store at your side, provide them to me with my reference."</p>
<p><code>w</code> &lt;hello id&gt; &lt;welcome id&gt; &lt;buffer&gt;</p>
<p>The hello id is the id as received in the hello message (by the other party). The welcome id is chosen by this Synchronizer, in the same manner.</p>
<h3>Update</h3>
<p>"Your store, with given reference, has changed.
The changes are attached."</p>
<p><code>u</code> &lt;id&gt; &lt;updates&gt;</p>
<p>The updates are a sequence of the triple: &lt;key&gt; &lt;length&gt; &lt;data&gt;. The key and length have the most significant bytes stripped, which would always be 0. The data is in the store's endianness.</p>
<h3>Bye</h3>
<p>"I do not need any more updates of the given store (by hash, by id or all)."</p>
<p>'b' hash 'b' id 'b'</p>
<p>A bye using the id can be used to respond to another message that has an unknown id. Previous communication sessions remnents can be cleaned up in this way. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
